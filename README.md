# 操作系统

## 内核（kernel）：硬件与应用的中间人

计算机是由各种外部硬件设备组成的，比如内存、cpu、硬盘等，如果每个应用都和这些硬件设备对接通信协议就太麻烦了，所以这个中间人就有内核来负责，让内核作为应用连接硬件设备的桥梁，应用程序只关心与内核交互，不用关心硬件细节。

---

- 内核能力：
  - 进程调度能力：管理进程、线程，决定哪个进程、线程使用CPU。
  - 内存管理能力：管理内存，决定内存的分配与回收。
  - 硬件通信能力：管理硬件设备，为进程与硬件设备之间提供通信能力。
  - 系统调用能力：提供系统调用，应用程序要运行更高权限运行的服务，就需要系统调用，它是用户程序与操作系统之间的接口。
	
---

- 内核工作：
  - 内核权限很高，而应用程序的权限很小。一般把内存分为两个区域：
    - 内核空间：只有内核程序可以访问。
    - 用户空间：专门给应用程序使用。
  - 用户态：程序使用用户空间时。
  - 内核态：程序使用内核空间时。
  - 程序从用户态转变为内核态是通过系统调用完成的。

---	

- Linux内核
  - MultiTask，多任务
多个任务同时执行，并发（单核）或并行（多核）
  - SMP，对称多处理
多个CPU地位相等，对资源使用权限相同，共享同一个内存，每个CPU都可以访问完整的内存和硬件资源。

这决定了Linux OS不会有某个CPU单独服务应用程序或内核程序，每个程序都可以被分配到任意一个CPU上执行。
  - ELF，可执行文件连接格式
  - Monolithic Kernel，宏内核
	Linux内核架构就是宏内核，意味着Linux的内核是一个完整的可执行程序，且拥有最高的权限。

	宏内核特征是系统内核的所有模块，比如进程调度、内存管理、文件系统、设备驱动等，都运行在内核态。

	微内核、混合类型内核





> ## 一、内存管理

### 虚拟内存：
- 不同进程的虚拟地址和不同内存的物理地址映射起来，该机制由操作系统提供。
   - 虚拟内存地址：用户程序所使用的内存地址。
   - 物理内存地址：实际存在硬件里面的空间地址。
- MMU：内存管理单元，管理虚拟内存与物理地址的映射关系。
	
### 内存分段
	程序是由若干逻辑分段组成，如代码分段、数据分段、栈段、堆段。不同的段是有不同的属性的，所以就用分段（Segmentation）的形式把这些段分离出来。
	虚拟地组成：段选择因子和段内偏移量
	- 段选择因子保存在段寄存器里，因子中的段号被用作段表的索引。段表里面保存的是段的基地址、段的界限和特权等级等。
	- 段内偏移量位于0和段界限之间，段基址加上段内偏移量得到物理内存地址。
	分段缺点：内存碎片、内存交换效率低
	- 内存碎片：
	  - 外部内存碎片：产生了多个不连续的小物理内存，导致新的程序无法被装载。
	  【解决问题】 内存交换（Swap）
	  - 内存交换：将已装载的程序暂时写到硬盘，然后再读回内存，但是装载回来的位置改变，将内存中的不连续的内存碎片组合成连续的，便又能装载其他程序。
	  - 内部内存碎片：程序所有的内存都被装载到了物理内存，但是程序有部分内存并不常用，导致内存浪费。
		  【解决问题】 内存分页

	- 内存交换效率低：
		对于多进程的系统来说，采用分段方式，内存碎片很容易产生，导致经常进行内存交换，但是硬盘的访问速度比内存慢太多，特别是交换大内存空间的程序，会显得机器卡顿。
		【解决问题】 内存分页
	
### 内存分页





### 段页式内存管理






>## 二、进程管理

- diyi
- dier
  - sjkd
- disan





>## 三、文件系统




>## 四、设备管理




	
